
@{
    ViewData["Title"] = "课程的详情页面";
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title> - 课程详情</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="shortcut icon" href="favicon.ico">
    <link href="~/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="~/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="~/css/animate.css" rel="stylesheet">
    <link href="~/css/style.css?v=4.1.0" rel="stylesheet">
</head>
<body class="gray-bg">
    <div class="row">
        <div class="col-sm-9">
            <div class="wrapper wrapper-content animated fadeInUp">
                <div class="ibox">
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-sm-12" id="course">
                                @*<div class="m-b-md">                                    
                                    <h2>课程名</h2> 
                                </div>
                                <dl class="dl-horizontal">
                                    <dt>状态：</dt>
                                    <dd>
                                        <span class="label label-primary">开课中</span>
                                    </dd>
                                </dl>*@
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-5">
                                <dl class="dl-horizontal">
                                    <dt>创建人：</dt>
                                    <dd>管理员</dd>
                                    <dt>消息：</dt>
                                    <dd>162</dd>                                   
                                </dl>
                            </div>
                            <div class="col-sm-7" id="cluster_info">
                                @*<dl class="dl-horizontal">
                                    <dt>创建于：</dt>
                                    <dd>data[0].createTimeStr</dd>
                                </dl>*@
                            </div>
                        </div>
                        @*<div class="row">
                            <div class="col-sm-12">
                                <dl class="dl-horizontal">
                                    <dt>当前存在的学习资料分类</dt>
                                    <dd>
                                        <div class="progress progress-striped active m-b-sm">
                                            <div style="width: 60%;" class="progress-bar"></div>
                                        </div>
                                        <small>当前存在的学习资料分类 <strong>60%</strong></small>
                                    </dd>
                                </dl>
                            </div>
                        </div>*@
                        <div class="row m-t-sm">
                            <div class="col-sm-12">
                                <div class="panel blank-panel">
                                    <div class="panel-heading">
                                        <div class="panel-options">
                                            <ul class="nav nav-tabs">
                                                <li>
                                                    <a href="project_detail.html#tab-1" data-toggle="tab">评论消息</a>
                                                </li>
                                                <li class="">
                                                    <a href="project_detail.html#tab-2" data-toggle="tab">资料上传信息</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="panel-body">
                                        <div class="tab-content">
                                            <div class="tab-pane active" id="tab-1">
                                                <div class="feed-activity-list">
                                                    <div class="feed-element">
                                                        <a href="profile.html#" class="pull-left">
                                                            <img alt="image" class="img-circle" src="~/img/a1.jpg">
                                                        </a>
                                                        <div class="media-body ">
                                                            <small class="pull-right text-navy">1天前</small>
                                                            <strong>奔波儿灞</strong> 关注了 <strong>灞波儿奔</strong>.
                                                            <br>
                                                            <small class="text-muted">54分钟前 来自 皮皮时光机</small>
                                                            <div class="actions">
                                                                <a class="btn btn-xs btn-white"><i class="fa fa-thumbs-up"></i> 赞 </a>
                                                                <a class="btn btn-xs btn-danger"><i class="fa fa-heart"></i> 收藏</a>
                                                            </div>
                                                        </div>
                                                    </div>                                                    
                                                    <div class="feed-element">
                                                        <a href="profile.html#" class="pull-left">
                                                            <img alt="image" class="img-circle" src="~/img/a3.jpg">
                                                        </a>
                                                        <div class="media-body ">
                                                            <small class="pull-right">2天前</small>
                                                            <strong>天猫</strong> 上传了2张图片
                                                            <br>
                                                            <small class="text-muted">11月7日 11:56 来自 微博 weibo.com</small>
                                                            <div class="photos">
                                                                <a target="_blank" href="http://24.media.tumblr.com/20a9c501846f50c1271210639987000f/tumblr_n4vje69pJm1st5lhmo1_1280.jpg">
                                                                    <img alt="image" class="feed-photo" src="~/img/p1.jpg">
                                                                </a>
                                                                <a target="_blank" href="http://37.media.tumblr.com/9afe602b3e624aff6681b0b51f5a062b/tumblr_n4ef69szs71st5lhmo1_1280.jpg">
                                                                    <img alt="image" class="feed-photo" src="~/img/p3.jpg">
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                   
                                                </div>
                                            </div>
                                            <div class="tab-pane" id="tab-2">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>状态</th>
                                                            <th>标题</th>
                                                            <th>上传时间</th>
                                                            <th>上传人</th>
                                                            <th>分类</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="tbody">
                                                        @*<tr>
                                                            <td>
                                                                <span class="label label-primary"><i class="fa fa-check"></i> 已完成</span>
                                                            </td>
                                                            <td>
                                                                文档在线预览功能
                                                            </td>
                                                            <td>
                                                                11月7日 22:03
                                                            </td>
                                                            <td>
                                                                11月7日 20:11
                                                            </td>
                                                            <td>
                                                                <p class="small">
                                                                    已经测试通过
                                                                </p>
                                                            </td>
                                                        </tr>*@

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="wrapper wrapper-content project-manager">
                <h4>课程描述</h4>
              
                <h5>最新上传的资料文档</h5>
                <ul class="list-unstyled project-files">
                    <li>
                        <a href="#"><i class="fa fa-file"></i> Project_document.docx</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-file-picture-o"></i> Logo_zender_company.jpg</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-stack-exchange"></i> Email_from_Alex.mln</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-file"></i> Contract_20_11_2014.docx</a>
                    </li>

                </ul>
                <div class="m-t-md">
                    <h4>添加文档</h4>
                </div>              
                <form method="post" enctype="multipart/form-data" action="/Files/Upload" onsubmit=checkform()>               
                    <div>
                        <p>选择文件:</p>
                        <input type="file" name="files" multiple id="uploadFile" onchange="show()"/><br />
                        标题：<input type="text" name="title" id="fileName"/><br /><br />
                    </div>
                    
                    <div>
                        <input type="submit" id="btnUpload" value="上 传" />
                        @*<input type="button" value="自动获取信息" id="bttn">*@
                    </div>
                        </form>
            </div>
        </div>
    </div>
    <!-- 全局js -->
    <script src="~/js/jquery.min.js?v=2.1.4"></script>
    <script src="~/js/bootstrap.min.js?v=3.3.6"></script>

    <!-- 自定义js -->
    <script src="~/js/content.js?v=1.0.0"></script>

    <script>

        //function getQueryVariable(variable) {
        //    var query = window.location.search.substring(1);
        //    var vars = query.split("&");
        //    for (var i = 0; i < vars.length; i++) {
        //        var pair = vars[i].split("=");
        //        if (pair[0] == variable) { return pair[1]; }
        //    }
        //}
        //var btn = document.getElementById("bttn");
        //var courseId = document.getElementById("courseId");
        //btn.onclick = function () {
        //    courseId.value = window.location.search.substring(1).split("=")[1];
        //    //console.log(getQueryVariable("courseId"));
        //    //console.log(window.document.location.href);
        //}
        $(document).ready(function () {

            $('#loading-example-btn').click(function () {
                btn = $(this);
                simpleLoad(btn, true)

                // Ajax example
                //                $.ajax().always(function () {
                //                    simpleLoad($(this), false)
                //                });

                simpleLoad(btn, false)
            });
        });

        var courseId = getUrlParam("courseId");

        f_RefreshCourseName(courseId);
        f_RefreshFiles(courseId);

        function f_RefreshCourseName(courseId) {
            $.get('FindCourse?courseId=' + courseId, function (data) {
                var data = eval(data);
                var str = `     <div class="m-b-md">
                                <h2>${data[0].courseName}</h2>
                                </div>
                                <dl class="dl-horizontal">
                                    <dt>状态：</dt>
                                    <dd>
                                        <span class="label label-primary">${data[0].statusStr}</span>
                                    </dd>
                                </dl>`;
                $("#course").append(str);

                var str1 = `<dl class="dl-horizontal">
                                    <dt>创建于：</dt>
                                    <dd>${data[0].createTimeStr}</dd>
                                </dl>`;
                $("#cluster_info").append(str1);
            });
        }

        function f_RefreshFiles(courseId) {
            $.get('/Files/ShowCheckFiles?courseId=' + courseId, function (data) {
                var data = eval(data);
                //console.log(data[0]);
                for (var i = 0; i < data.length; i++) {
                    //console.log(data[0].fileName.split(".")[1]);
                    var str = "<tr>" +
                        "<td>" +
                        "<span class=\"label label-primary\"><i class=\"fa \"></i>" + data[i].statusStr + "</span>" +
                        "</td>" +
                        "<td>" +
                        "<a href=\"javascript: void (0);\" onclick =\"f_skipFiles('" + data[i].fileURL.replace(/\\/g, '-') + "')\">" + data[i].fileName + "</a>" +                        
                        "</td>" +
                        "<td>" +
                        data[i].fileTimeStr +
                        "</td>" +
                        "<td>" +
                        data[i].uploadName +
                        "</td>" +
                        "<td>" + data[i].fileName.split(".")[1] + " </td>" +
                        "</tr>"; 
                    $(".tbody").append(str);
                }
            });
        }

        function f_skipFiles(url) {
            //alert(url)
            window.location.href = url.replace(/-/g, '\\');
        }




        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象

            var r = window.location.search.substr(1).match(reg);  //匹配目标参数

            if (r != null) return unescape(r[2]);

            return null; //返回参数值

        }

        //$("#btnUpload").click(function () {
        //    var date = new Date();
        //    var year = date.getFullYear();
        //    var month = date.getMonth() + 1;
        //    var day = date.getDate();
        //    var Hours = date.getHours();
        //    var Minutes = date.getMinutes();
        //    var Seconds = date.getSeconds();
        //    if (month < 10) {
        //        month = "0" + month;
        //    }
        //    if (day < 10) {
        //        day = "0" + day;
        //    }
        //    var fileTime = year + '-' + month + '-' + day + ' ' + Hours + ':' + Minutes + ':' + Seconds;          

        //    var formData = new FormData();
        //    formData.append('file', $('#newTemplateFileId')[0].files[0]);
        //    formData.append('fileName', $('#fileName').val());
        //    formData.append('fileTime', fileTime);
        //    formData.append('uploadName', username);
        //    formData.append('courseId', courseId);
        //    formData.append('status', '0');

        //    //alert(JSON.stringify(formData));

        //    console.log(formData);
        //    //jQuery.support.cors = true;
        //    $.ajax({
        //        async: true,
        //        contentType: false, //头部请求内容格式
        //        dataType: 'json',
        //        type: 'post',
        //        data:formData,
        //        // 告诉jQuery不要去处理发送的数据
        //        processData: false,
        //        url: "http://localhost:5000/Files/Upload",//后端接收接口
        //        success: function(data) {
        //            //后端Httpclient请求成功后返回过来的结果
        //            console.log(data);
        //        }
        //    });

        //});
       

        function show() {
            var a = document.getElementById("uploadFile").value;
            var arr = a.split('\\');
            //得到文件名称
            console.log(arr[arr.length - 1]);
            document.getElementById("fileName").value = arr[arr.length - 1];
            //console.log(document.getElementById("fileName").value);
        }
        
        function checkform() {
        
            var date = new Date();
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            var Hours = date.getHours();
            var Minutes = date.getMinutes();
            var Seconds = date.getSeconds();
            if (month < 10) {
                month = "0" + month;
            }
            if (day < 10) {
                day = "0" + day;
            }
            var fileTime = year + '-' + month + '-' + day + ' ' + Hours + ':' + Minutes + ':' + Seconds;

             @{ var username = CurrentUser.UserName; }
            var username = "@username";

            var file = new Object();
            file.fileName = $("#fileName").val();
            file.fileTime = fileTime;
            file.uploadName = username;
            file.courseId = courseId;
            file.status = '0';
            alert(JSON.stringify(file));
            $.ajax({
                type: 'POST',
                url: "/Files/AddFile",
                //data: JSON.stringify(course),
                data: {
                    fileName : $("#fileName").val(),
                    fileTime : fileTime,
                    uploadName : username,
                    courseId : courseId,
                    status: '0'
                },
                dataType: "JSON",
                //contentType: "application/json",
                success: function (result) {
                    alert(result.msg);
                },
                error: function (result) {
                }
            });

        }



        function simpleLoad(btn, state) {
            if (state) {
                btn.children().addClass('fa-spin');
                btn.contents().last().replaceWith(" Loading");
            } else {
                setTimeout(function () {
                    btn.children().removeClass('fa-spin');
                    btn.contents().last().replaceWith(" Refresh");
                }, 2000);
            }
        }</script>


</body>
</html>

